这是一个关于数据库设计和实现的大作业。以下是一个关于宿舍管理系统的案例实施方案，包含了数据库的创建、表的设计、数据录入和查询实现：

### 数据库设计

#### 1. 创建数据库
- 数据库名称：`sushe`
- 创建语句：
  ```sql
  CREATE DATABASE sushe;
  ```

#### 2. 创建表结构
- **学生表(Student)**
  - 字段：ID（主键）, 姓名, 性别, 年龄, 班级ID
  - 创建语句：
    ```sql
    CREATE TABLE Student (
      ID INT PRIMARY KEY,
      Name VARCHAR(50),
      Gender VARCHAR(10),
      Age INT,
      ClassID INT
    );
    ```

- **班级表(Class)**
  - 字段：ID（主键）, 班级名称, 辅导员
  - 创建语句：
    ```sql
    CREATE TABLE Class (
      ID INT PRIMARY KEY,
      ClassName VARCHAR(50),
      Counselor VARCHAR(50)
    );
    ```

- **宿舍表(Dormitory)**
  - 字段：宿舍号（主键）, 楼层, 可容纳人数
  - 创建语句：
    ```sql
    CREATE TABLE Dormitory (
      DormitoryID INT PRIMARY KEY,
      Floor INT,
      Capacity INT
    );
    ```

- **宿舍分配表(DormitoryAssignment)**
  
  - 字段：学生ID, 宿舍号（混合主键）
  - 创建语句：
    ```sql
    CREATE TABLE DormitoryAssignment (
      StudentID INT,
      DormitoryID INT,
      PRIMARY KEY (StudentID, DormitoryID),
      FOREIGN KEY (StudentID) REFERENCES Student(ID),
      FOREIGN KEY (DormitoryID) REFERENCES Dormitory(DormitoryID)
    );
    ```

请注意，每种查询不少于五个，请整理好后，给我 单表查询，交叉表查询，统计查询，聚集查询，子查询，实现对表结构和表记录进行操纵的查询

 好的,我重新为每个表插入20条具体的数据,语句如下:

**向Student表插入数据:**

```sql 
INSERT INTO Student VALUES (1001, '张三', '男', 18, 1);
INSERT INTO Student VALUES (1002, '李四', '女', 17, 1);
INSERT INTO Student VALUES (1003, '王五', '女', 16, 1);
INSERT INTO Student VALUES (1004, '赵六', '男', 18, 1);
INSERT INTO Student VALUES (1005, '孙七', '女', 17, 2);
INSERT INTO Student VALUES (1006, '周八', '男', 19, 2);
INSERT INTO Student VALUES (1007, '吴九', '男', 18, 2);  
INSERT INTO Student VALUES (1008, '郑十', '女', 16, 3);
INSERT INTO Student VALUES (1009, '王十一', '女', 17, 3);
INSERT INTO Student VALUES (1010, '张十二', '男', 20, 3);
INSERT INTO Student VALUES (1011, '宋十三', '女', 18, 4); 
INSERT INTO Student VALUES (1012, '李十四', '男', 19, 4);
INSERT INTO Student VALUES (1013, '陈十五', '女', 18, 4);
INSERT INTO Student VALUES (1014, '黄十六', '男', 17, 5);
INSERT INTO Student VALUES (1015, '张十七', '女', 16, 5);  
INSERT INTO Student VALUES (1016, '王十八', '女', 18, 5);
INSERT INTO Student VALUES (1017, '李十九', '男', 19, 6);
INSERT INTO Student VALUES (1018, '赵二十', '男', 18, 6);  
INSERT INTO Student VALUES (1019, '孙二十一', '女', 17, 6);
INSERT INTO Student VALUES (1020, '周二十二', '女', 16, 6);
```

**向Class表插入数据:**

```sql
INSERT INTO Class VALUES (1, '一年一班', '陈老师');
INSERT INTO Class VALUES (2, '一年二班', '李老师');  
INSERT INTO Class VALUES (3, '一年三班', '王老师');
INSERT INTO Class VALUES (4, '一年四班', '张老师');
INSERT INTO Class VALUES (5, '一年五班', '赵老师');
INSERT INTO Class VALUES (6, '一年六班', '孙老师'); 
INSERT INTO Class VALUES (7, '二年一班', '周老师'); 
INSERT INTO Class VALUES (8, '二年二班', '郑老师');
INSERT INTO Class VALUES (9, '二年三班', '吴老师');  
INSERT INTO Class VALUES (10, '二年四班', '宋老师');  
INSERT INTO Class VALUES (11, '三年一班', '黄老师');
INSERT INTO Class VALUES (12, '三年二班', '杨老师');
INSERT INTO Class VALUES (13, '三年三班', '马老师');
INSERT INTO Class VALUES (14, '三年四班', '苏老师'); 
INSERT INTO Class VALUES (15, '三年五班', '董老师');
INSERT INTO Class VALUES (16, '四年一班', '王老师');
INSERT INTO Class VALUES (17, '四年二班', '冯老师');
INSERT INTO Class VALUES (18, '四年三班', '朱老师');
INSERT INTO Class VALUES (19, '四年四班', '曹老师'); 
INSERT INTO Class VALUES (20, '四年五班', '丁老师');
```

**向Dormitory表插入数据:**

```sql
INSERT INTO Dormitory VALUES (101, 1, 4);
INSERT INTO Dormitory VALUES (102, 1, 4);
INSERT INTO Dormitory VALUES (103, 1, 4); 
INSERT INTO Dormitory VALUES (104, 1, 4);
INSERT INTO Dormitory VALUES (105, 2, 4);
INSERT INTO Dormitory VALUES (106, 2, 4);  
INSERT INTO Dormitory VALUES (107, 2, 6);
INSERT INTO Dormitory VALUES (108, 2, 6);
INSERT INTO Dormitory VALUES (109, 3, 4);
INSERT INTO Dormitory VALUES (110, 3, 4);
INSERT INTO Dormitory VALUES (111, 3, 6);
INSERT INTO Dormitory VALUES (112, 3, 6);  
INSERT INTO Dormitory VALUES (113, 4, 4);
INSERT INTO Dormitory VALUES (114, 4, 4);
INSERT INTO Dormitory VALUES (115, 4, 6);
INSERT INTO Dormitory VALUES (116, 4, 6);
INSERT INTO Dormitory VALUES (117, 5, 4);
INSERT INTO Dormitory VALUES (118, 5, 4);
INSERT INTO Dormitory VALUES (119, 5, 6);
INSERT INTO Dormitory VALUES (120, 5, 6);
```

**向DormitoryAssignment表插入数据:**  

```sql
INSERT INTO DormitoryAssignment VALUES (1001, 101);
INSERT INTO DormitoryAssignment VALUES (1002, 101); 
INSERT INTO DormitoryAssignment VALUES (1003, 101);
INSERT INTO DormitoryAssignment VALUES (1004, 101);
INSERT INTO DormitoryAssignment VALUES (1005, 102);
INSERT INTO DormitoryAssignment VALUES (1006, 102);  
INSERT INTO DormitoryAssignment VALUES (1007, 102);
INSERT INTO DormitoryAssignment VALUES (1008, 102);
INSERT INTO DormitoryAssignment VALUES (1009, 103);
INSERT INTO DormitoryAssignment VALUES (1010, 103);
INSERT INTO DormitoryAssignment VALUES (1011, 103);  
INSERT INTO DormitoryAssignment VALUES (1012, 103); 
INSERT INTO DormitoryAssignment VALUES (1013, 104);
INSERT INTO DormitoryAssignment VALUES (1014, 104);
INSERT INTO DormitoryAssignment VALUES (1015, 104);
INSERT INTO DormitoryAssignment VALUES (1016, 104);
INSERT INTO DormitoryAssignment VALUES (1017, 105);
INSERT INTO DormitoryAssignment VALUES (1018, 105);
INSERT INTO DormitoryAssignment VALUES (1019, 105);  
INSERT INTO DormitoryAssignment VALUES (1020, 105);
```





**单表查询:**

```sql
# 查询所有学生信息
SELECT * FROM Student;

# 查询学号为1001的学生姓名和性别  
SELECT Name, Gender FROM Student WHERE ID = 1001;

# 查询年龄大于20岁的学生姓名和年龄
SELECT Name, Age FROM Student WHERE Age > 20; 

# 查询所有女生信息
SELECT * FROM Student WHERE Gender = '女';

# 查询学号,姓名和班级名称
SELECT s.ID, s.Name, c.ClassName 
FROM Student s LEFT JOIN Class c ON s.ClassID = c.ID;
```

**交叉表查询:**

```sql 
# 查询每个班级的学生人数
SELECT c.ClassName, COUNT(s.ID) AS NumOfStudents
FROM Student s RIGHT JOIN Class c ON s.ClassID = c.ID
GROUP BY c.ClassName;

# 查询每个宿舍的住人数
SELECT d.DormitoryID, COUNT(sa.StudentID) AS Occupancy  
FROM DormitoryAssignment sa RIGHT JOIN Dormitory d 
ON sa.DormitoryID = d.DormitoryID
GROUP BY d.DormitoryID;

# 查询每间宿舍已住和未住人数
SELECT d.DormitoryID, d.Capacity AS Total, COUNT(sa.StudentID) AS Occupied, d.Capacity - COUNT(sa.StudentID) AS Vacancies
FROM Dormitory d LEFT JOIN DormitoryAssignment sa
ON d.DormitoryID = sa.DormitoryID
GROUP BY d.DormitoryID;

# 查询每名学生的宿舍号  
SELECT s.ID, s.Name, IFNULL(da.DormitoryID, '未分配') AS DormitoryID
FROM Student s LEFT JOIN DormitoryAssignment da
ON s.ID = da.StudentID; 
```

**统计查询:**  

```sql
# 统计男女生人数
SELECT Gender, COUNT(ID) AS NumOfStudents
FROM Student
GROUP BY Gender;

# 统计大于20岁学生的数量
SELECT COUNT(ID) AS NumOfAdultStudents
FROM Student
WHERE Age > 20; 

# 统计每层宿舍数量
SELECT Floor, COUNT(*) AS NumOfDorms 
FROM Dormitory
GROUP BY Floor;

# 统计空床位数
SELECT SUM(d.Capacity - IFNULL(b.Occupancy, 0)) AS Vacancies
FROM Dormitory d LEFT JOIN  
(SELECT DormitoryID, COUNT(StudentID) AS Occupancy
FROM DormitoryAssignment GROUP BY DormitoryID) b
ON d.DormitoryID = b.DormitoryID;
```

**聚集查询:**

```sql
# 查询年龄最大的学生信息 
SELECT *
FROM Student
WHERE Age = (SELECT MAX(Age) FROM Student);

# 查询容纳人数第二多的宿舍
SELECT * 
FROM Dormitory
WHERE Capacity = (
  SELECT DISTINCT Capacity
  FROM Dormitory
  ORDER BY Capacity DESC
  LIMIT 1 OFFSET 1
);

# 查询人数最多宿舍信息
SELECT d.*
FROM Dormitory d 
LEFT JOIN 
   (SELECT DormitoryID, COUNT(StudentID) AS num
    FROM DormitoryAssignment  
    GROUP BY DormitoryID) da  
ON d.DormitoryID = da.DormitoryID
ORDER BY da.num DESC
LIMIT 1;

# 查询年龄最小的女生信息  
SELECT *  
FROM Student
WHERE Gender = '女'
ORDER BY Age ASC
LIMIT 1;
```

**子查询:**

```sql
# 查询每个宿舍剩余可容纳人数
SELECT d.*, d.Capacity - IFNULL(b.Occupancy, 0) AS Vacancy
FROM Dormitory d LEFT JOIN
(SELECT DormitoryID, COUNT(StudentID) AS Occupancy 
 FROM DormitoryAssignment GROUP BY DormitoryID) b 
ON d.DormitoryID = b.DormitoryID;

# 查询姓名中包含'四'字的学生姓名和班级名称
SELECT s.Name, c.ClassName
FROM Student s LEFT JOIN Class c ON s.ClassID = c.ID
WHERE s.Name LIKE '%四%'; 


# 查询每间宿舍剩余床位数最多的宿舍  
SELECT *
FROM Dormitory
WHERE (Capacity - IFNULL((
  SELECT COUNT(StudentID) 
  FROM DormitoryAssignment
  WHERE Dormitory.DormitoryID = DormitoryAssignment.DormitoryID
), 0)) = (  
  SELECT MAX(Capacity - IFNULL(Occupancy, 0))
  FROM
  (SELECT DormitoryID, COUNT(StudentID) AS Occupancy
   FROM DormitoryAssignment  
   GROUP BY DormitoryID) t1
  RIGHT JOIN Dormitory t2
  ON t1.DormitoryID = t2.DormitoryID
);

# 查询姓名中包含“三”的女生姓名和年龄 
SELECT Name, Age 
FROM Student
WHERE Name LIKE '%三%'
AND Gender = '女';

```

**表记录操纵:**

```sql
# 向学生表中插入一条记录
INSERT INTO Student (ID, Name, Gender, Age, ClassID) 
VALUES (1082, '李明', '男', 18, 1);

# 更新ID为1001的学生年龄 
UPDATE Student SET Age = Age + 1 WHERE ID = 1001;  

# 删除班级名称为一年一班的记录
DELETE FROM Class WHERE ClassName = '一年一班';

修改宿舍表的楼层字段类型
ALTER TABLE Dormitory 
MODIFY COLUMN Floor VARCHAR(10);

更新学生表中姓名为“张三”的学生的年龄增加一岁
UPDATE Student 
SET Age = Age + 1
WHERE Name = '张三'; 
```



